---
title: "problem-set-4-ADobbins97"
author: "Alexandra Dobbins"
date: "2/25/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(gt)
library(dplyr)
library(fivethirtyeight)
library(ggplot2)

nc09 <- read_csv(file = "ps_4_elections-poll-nc09-3.csv", 
                  col_types =  cols(
                   .default = col_character(),
                   turnout_scale = col_double(),
                   turnout_score = col_double(),
                   w_LV = col_double(),
                   w_RV = col_double(),
                   final_weight = col_double(),
                   timestamp = col_datetime(format = "")))

```


```{r}
nc_09 <-
  nc09 %>% 
    select(response, race_eth, final_weight) %>%
    group_by(response, race_eth) %>% 
    summarize(total = sum(final_weight)) %>% 
    filter(race_eth != "[DO NOT READ] Don't know/Refused") %>%
    spread(key = response, value = total) %>% 
    replace_na(list(Und = 0)) %>% 
    mutate(all = Dem + Rep + Und) %>% 
      mutate(Dem = Dem/all) %>% 
      mutate(Rep = Rep/all) %>% 
      mutate(Und = Und/all) %>% 
    select(race_eth, Dem, Rep, Und) %>% 
    ungroup() %>% 
    mutate(race_eth = fct_relevel(race_eth, "White", "Black", "Hispanic", "Asian", "Other")) %>% 
    arrange(race_eth) 

Dem_Support <- 
  nc09 %>% 
  filter(response == "Dem") %>% 
  nrow()

RepCount <- nc09 %>% 
  filter(response == "Rep") %>% 
  nrow()
UndCount <- nc09 %>%  
  filter(response == "Und") %>% 
  nrow()

GenderDiff <- 
  nc09 %>%
  select(gender, gender_combined) %>% 
  filter(gender != gender_combined) %>% 
  nrow()

White <-
  nc09 %>% 
  select(race_eth, file_race_black) %>% 
  filter(race_eth == "White", race_eth != file_race_black) %>%
  nrow()
  
dem_time <- nc09 %>% filter(response == "Dem") %>%  slice(1) %>%  pull(timestamp)
rep_time <- nc09 %>% filter(response == "Rep") %>%  slice(1) %>%  pull(timestamp)

```

**Question 1:**

There were `r Dem_Support` respondents who supported the Democratic candidate.

There were `r RepCount - UndCount` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables `gender` and `gender_combined`. There are `r GenderDiff` individuals for whom these variables have different values.

There are `r White` respondents listed as "White" under `race_eth` who are not listed as "White" under `file_race_black`.

The first response of Rep came `r round(rep_time - dem_time)` minutes (rounded to the nearest minute) before the first response of Dem.



**Question 2:**

```{r}
#Question 2

nc_09 %>% 
  gt() %>% 
  tab_header(title = "North Carolina's 9th Congressional District Voting Distribution by Race and Party")%>% 
  cols_label(
    race_eth = "Ethnicity",
    Dem = "DEM.",
    Rep = "REP.",
    Und = "UND."
    ) %>%
  fmt_percent(columns = vars(Dem, Rep, Und), decimals = 0) %>% 
  na_if(0) %>% 
  fmt_missing(columns = vars(Und), rows = 4)

```



**Question 3:**

```{r}
#Question 3

nc_educ <-
  nc09 %>% 
    select(educ, final_weight) %>%
    filter(educ != "[DO NOT READ] Refused") %>%
    mutate(educ = fct_relevel(educ, "Grade school", "High school", "Some college or trade school", "Bachelors' degree", "Graduate or Professional Degree"))

nc_educ %>% 
  ggplot(aes(x = educ, y = final_weight)) +
  geom_violin()+
  coord_flip()+
  geom_jitter(aes(x = educ, y = final_weight), width = .24, size = 1, alpha = .5)+
  labs(title = "More Educated Matter Less in North Carolina 9th", subtitle = "Poll gives more weight to people who are less likely to participate in polls", caption = "New York Times Upshot/Siena College 2018 live polls")+
  ylab("Weight Given to Respondent in Calculating Poll Results")+
  xlab("")

```

Question 4:

```{r }

#Question 4



```

Colleagues:
Mike Silva, Adiya Abdilkhay, Seeam Noor, Christopher Onesti, Charlie Flood, Albert Shin
